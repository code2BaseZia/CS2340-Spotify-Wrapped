{% extends 'wrapped/index.html' %}
{% load static %}
{% load social_share %}

{% block title %}{% if user.is_authenticated %}Stats{% else %}Home{% endif %}{% endblock %}
{% block css %}
    <link rel="stylesheet" href="https://use.typekit.net/lha8mkp.css">
    <link rel="stylesheet" href="{% static 'wrapped/css/sliders.css' %}">
{% endblock %}
    
{% block content %}
    <span class="absolute top-2 inset-x-2 col-span-full flex flew-row items-center gap-1" id="indicators">
        <progress value="0" max="100" class="progress"></progress>
        <progress value="0" max="100" class="progress"></progress>
        <progress value="0" max="100" class="progress"></progress>
        <progress value="0" max="100" class="progress"></progress>
        <progress value="0" max="100" class="progress"></progress>
        <progress value="0" max="100" class="progress"></progress>
        <progress value="0" max="100" class="progress"></progress>
        <progress value="0" max="100" class="progress"></progress>
        <progress value="0" max="100" class="progress"></progress>
        <progress value="0" max="100" class="progress"></progress>
        <progress value="0" max="100" class="progress"></progress>
    </span>
    <script>
        const animations = Array.from({length: 11}, () => ({ start: () => {}, end: () => {}}))
        const tracks = ['{{ top_track_in_top_album.preview }}', '{{ top_track_by_top_artist.preview }}', '{{ top_track_by_top_artist.preview }}', '{{ top_tracks.0.preview }}', '{{ top_tracks.0.preview }}', '{{ most_popular_track.preview }}', '{{ most_popular_track.preview }}', '{{ top_track_in_top_album.preview }}', '{{ top_track_in_top_album.preview }}', '{{ top_track_by_top_artist_of_top_genre.preview }}', '{{ top_track_by_top_artist_of_top_genre.preview }}']
        const id = {{ id }}
        let isPublic = {{ public|lower }}
    </script>
    <div id="container" class="row-start-1 col-start-1 col-span-4 md:col-start-2 md:col-span-6 lg:col-start-3 lg:col-span-8 aspect-square overflow-x-hidden relative mt-10">
        <div id="slides" class="size-full flex flex-row justify-start items-stretch gap-0 absolute">
            {% for slide in slides %}
                <div class="carousel-item size-full overflow-hidden relative" data-theme="{{ slide.colors }}">
                    {% with "wrapped/wraps/s"|add:slide.number|add:slide.layout|add:".html" as template %}
                        {% include template %}
                    {% endwith %}
                </div>
            {% endfor %}
        </div>
    </div>
    <button id="left" class="row-start-1 col-start-1 lg:col-start-2 mr-[-0.75rem] flex flex-col items-center justify-center arrow relative z-40">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-8 drop-shadow-lg">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
        </svg>
    </button>
    <button id="right" class="row-start-1 col-start-4 md:col-start-8 lg:col-start-11 ml-[-0.75rem] flex flex-col items-center justify-center arrow relative z-40">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-8 drop-shadow-lg">
            <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
        </svg>
    </button>
    {% if owner == user.username %}
        <div class="col-start-1 md:col-start-2 lg:col-start-3 col-span-2 flex items-center justify-stretch row-start-2 gap-2 py-2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 grow-0" id="volumeIcon">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 9.75 19.5 12m0 0 2.25 2.25M19.5 12l2.25-2.25M19.5 12l-2.25 2.25m-10.5-6 4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z" />
            </svg>
            <input type="range" min="0" max="100" value="0" class="grow text-accent" id="volume" />
        </div>
        <div class="col-span-2 row-start-2 col-start-3 md:col-start-6 lg:col-start-9 flex justify-between">
            <span class="flex flex-col items-center">
                Visibility
                <span class="grow flex flex-col items-center justify-center">
                    <label for="visibility" class="flex items-center cursor-pointer select-none">
                        <span class="relative">
                            <input type="checkbox" id="visibility" class="peer sr-only" />
                            <span class="block h-8 rounded-full box bg-base-200 w-14 peer-checked:bg-accent transition-colors"></span>
                            <span class="absolute flex items-center justify-center w-6 h-6 transition bg-current rounded-full dot left-1 top-1 peer-checked:translate-x-full"></span>
                        </span>
                    </label>
                    <small id="visibilityText">Private</small>
                </span>
            </span>
            <span class="flex flex-col items-center">
                Share
                <span class="grow flex items-center">
                    <button class="btn btn-accent rounded-full size-12 py-2 pl-1.5 pr-2.5 min-h-0" onclick="wrap_modal.showModal()">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                             stroke="currentColor" class="size-8">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                  d="M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"/>
                        </svg>
                    </button>
                </span>
            </span>
        </div>
    {% else %}
        <div class="col-span-full flex items-center justify-center row-start-2 gap-2 py-2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 grow-0" id="volumeIcon">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 9.75 19.5 12m0 0 2.25 2.25M19.5 12l2.25-2.25M19.5 12l-2.25 2.25m-10.5-6 4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z" />
            </svg>
            <input type="range" min="0" max="100" value="0" class="grow max-w-xs text-accent" id="volume" />
        </div>
    {% endif %}
    <dialog id="wrap_modal" class="modal">
        <div class="modal-box">
            <form method="dialog" onsubmit="updateModal()">
                <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">âœ•</button>
            </form>
            <h3 class="text-lg font-bold">Share to...</h3>
            <p class="extra-visibility">For others to be able to see your wrapped, you need to make it public. You can do this by checking the box below.</p>
            <div class="form-control extra-visibility">
                <label class="cursor-pointer label ml-auto gap-2">
                    <span class="label-text">Set this wrapped to public</span>
                    <input type="checkbox" id="extraVisibility" class="checkbox checkbox-accent"/>
                </label>
            </div>
            <div class="flex items-center justify-evenly w-full">
                <span class="flex flex-col items-center gap-2">
                    {% post_to_twitter "Take a look at my custom-made Spotify Wrapped using Spotify Wrapper!" object_or_url '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor" class="size-8"><!--!Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M459.4 151.7c.3 4.5 .3 9.1 .3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53 51.7 63.7 129.3 105.3 216.4 109.8-1.6-7.8-2.6-15.9-2.6-24 0-57.8 46.8-104.9 104.9-104.9 30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3z"/></svg>' "btn btn-primary rounded-full size-12 p-2 min-h-0" %}
                    <small>Twitter</small>
                </span>
                <span class="flex flex-col items-center gap-2">
                    {% post_to_reddit "Take a look at my custom-made Spotify Wrapped using Spotify Wrapper!" object_or_url '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="size-8 fill-primary-content"><!--!Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M373 138.6c-25.2 0-46.3-17.5-51.9-41l0 0c-30.6 4.3-54.2 30.7-54.2 62.4l0 .2c47.4 1.8 90.6 15.1 124.9 36.3c12.6-9.7 28.4-15.5 45.5-15.5c41.3 0 74.7 33.4 74.7 74.7c0 29.8-17.4 55.5-42.7 67.5c-2.4 86.8-97 156.6-213.2 156.6S45.5 410.1 43 323.4C17.6 311.5 0 285.7 0 255.7c0-41.3 33.4-74.7 74.7-74.7c17.2 0 33 5.8 45.7 15.6c34-21.1 76.8-34.4 123.7-36.4l0-.3c0-44.3 33.7-80.9 76.8-85.5C325.8 50.2 347.2 32 373 32c29.4 0 53.3 23.9 53.3 53.3s-23.9 53.3-53.3 53.3zM157.5 255.3c-20.9 0-38.9 20.8-40.2 47.9s17.1 38.1 38 38.1s36.6-9.8 37.8-36.9s-14.7-49.1-35.7-49.1zM395 303.1c-1.2-27.1-19.2-47.9-40.2-47.9s-36.9 22-35.7 49.1c1.2 27.1 16.9 36.9 37.8 36.9s39.3-11 38-38.1zm-60.1 70.8c1.5-3.6-1-7.7-4.9-8.1c-23-2.3-47.9-3.6-73.8-3.6s-50.8 1.3-73.8 3.6c-3.9 .4-6.4 4.5-4.9 8.1c12.9 30.8 43.3 52.4 78.7 52.4s65.8-21.6 78.7-52.4z"/></svg>' "btn btn-secondary rounded-full size-12 p-2 min-h-0" %}
                    <small>Reddit</small>
                </span>
                <span class="flex flex-col items-center gap-2">
                    {% copy_to_clipboard object_or_url '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-8"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184" /></svg>' "btn rounded-full size-12 p-2 min-h-0"%}
                    <small>Copy Link</small>
                </span>
            </div>
        </div>
    </dialog>
    {% add_copy_script %}
{% endblock %}

{% block scripts %}
    <script src="{% static 'wrapped/js/wrap.js' %}"></script>
    {% if owner == user.username %}
        <script src="{% static 'wrapped/js/owner.js' %}"></script>
    {% endif %}
{% endblock %}